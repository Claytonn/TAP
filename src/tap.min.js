!function(t,e,n){var i=function(n,r){return this.defaults={},this.init=function(e,n){return e?e.nodeType&&this.isCompatible()?(this.settings=n?this.applyOptions(this.defaults,n):defaults,this.elm=e,this.replaceElement(),this):t===this?new i(e,n):void 0:this},this.applyOptions=function(t,e){for(var n in e)try{e[n].constructor===Object?t[n]=applyOptions(t[n],e[n]):t[n]=e[n]}catch(i){t[n]=e[n]}return t},this.replaceElement=function(){for(var t=e.createElement("div"),n=this.elm.attributes,i=0;i<n.length;i++)t.setAttribute(n[i].nodeName,n[i].nodeValue);t.setAttribute("contentEditable",!0),this.elm.parentNode.replaceChild(t,this.elm),this.elm=t,this.attachEvents()},this.attachEvents=function(){for(var t in this.events)this.attachEvent?this.elm.attachEvent("on"+t,this.events[t].bind(this)):this.elm.addEventListener(t,this.events[t].bind(this),!1)},this.isCompatible=function(){return null!==e.createElement("div").contentEditable?!0:!1},this.applyFormatting=function(t){for(var n=this.settings.patterns,i=0;i<n.length;i++)var r=new RegExp(n[i].regex[0],n[i].regex[1]?n[i].regex[1]:""),t=t.replace(r,function(t){tempCon=e.createElement("div"),tempElm=e.createElement(n[i].element);for(attr in n[i].attributes)tempElm.setAttribute(attr,n[i].attributes[attr]);return tempCon.appendChild(tempElm),tempElm.innerHTML=t,tempCon.innerHTML});return t},this.getSelectedText=function(){return t.getSelection?t.getSelection():e.getSelection?e.getSelection():e.selection?e.selection.createRange().text:!1},this.caretPosition={saveSelection:function(n){if(t.getSelection&&e.createRange){var i=t.getSelection().getRangeAt(0),r=i.cloneRange();r.selectNodeContents(n),r.setEnd(i.startContainer,i.startOffset);var s=r.toString().length;return{start:s,end:s+i.toString().length}}if(e.selection){var a=e.selection.createRange(),o=e.body.createTextRange();o.moveToElementText(n),o.setEndPoint("EndToStart",a);var s=o.text.length;return{start:s,end:s+a.text.length}}},restoreSelection:function(n,i){if(t.getSelection&&e.createRange){var r=0,s=e.createRange();s.setStart(n,0),s.collapse(!0);for(var a,o=[n],l=!1,c=!1;!c&&(a=o.pop());)if(3==a.nodeType){var h=r+a.length;!l&&i.start>=r&&i.start<=h&&(s.setStart(a,i.start-r),l=!0),l&&i.end>=r&&i.end<=h&&(s.setEnd(a,i.end-r),c=!0),r=h}else for(var m=a.childNodes.length;m--;)o.push(a.childNodes[m]);var u=t.getSelection();u.removeAllRanges(),u.addRange(s)}else if(e.selection){var d=e.body.createTextRange();d.moveToElementText(n),d.collapse(!0),d.moveEnd("character",i.end),d.moveStart("character",i.start),d.select()}}},this.events={keyup:function(t){if(this.elm.textContent!=this.getSelectedText()){var e=this.caretPosition.saveSelection(this.elm);this.elm.innerHTML=this.applyFormatting(this.elm.textContent),this.caretPosition.restoreSelection(this.elm,e)}}},this.init(n,r)};i.prototype={textLength:function(){return this.elm.textContent.length},clear:function(){return this.elm.innerHTML="",this},innerText:function(){return this.elm.textContent},innerHTML:function(){return this.elm.innerHTML},element:function(){return this.elm}},t.tap=i}(window,document);